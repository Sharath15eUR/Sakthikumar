TODO: Refactor function
Note: Update dependencies
